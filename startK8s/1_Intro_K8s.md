# 쿠버네티스를 시작하기 전에
쿠버네티스를 설치 후 사용해 볼 차례이다. 그 전에 몇 가지 쿠버네티스의 특징을 짚고 넘어가려고 한다.

## 모든 리소스는 오브젝트 형태로 관리
- 쿠버네티스는 대부분의 리소스를 `오브젝트`라고 불리는 형태로 관리한다.
- 쿠버네티스는 `오브젝트`라는 개념의 단위를 폭넓고 세밀한 단위로 사용한다.
- 예를 들어 쿠버네티스에는 `컨테이너 집합(Pods)`, `컨테이너의 집합을 관리하는 컨트롤러(Replica Set)`, 심지어 `사용자(Service Account)`, `노드(Node)`까지도 하나의 오브젝트로 사용할 수 있다.
- `kubectl api-resources` 명령어를 사용해 쿠버네티스에서 사용할 수 있는 오브젝트의 종류에 관해 알 수 있다.
- 특정 오브젝트의 간단한 설명을 보고 싶다면 `kubectl explain` 명령어를 사용한다.
    ```
    kubectl explain pods
    KIND:       Pod
    VERSION:    v1

    DESCRIPTION:
        Pod is a collection of containers that can run on a host. This resource is
        created by clients and scheduled onto hosts.
    ...
    ```


## 쿠버네티스는 명령어로도 사용할 수 있지만, YAML 파일을 더 많이 사용
- 쿠버네티스에서는 `kubectl`이라는 명령어를 통해 쿠버네티스를 사용할 수 있으며, 작업의 대부분은 `kubectl` 명령어로 실행 가능하다.
- 그리고 `YAML`파일로 쿠버네티스에서 컨테이너 리소스를 생성하거나 삭제할 수 있다.
- 그러나 쿠버네티스에서 `YAML`파일의 용도는 컨테이너뿐만 아니라 거의 모든 리소스 오브젝트들에 사용될 수 있다.
- 예를 들어, 컨테이너 자체는 물론, 컨테이너 설정값(ConfigMap), 비밀값(Secrets) 등도 모두 YAML 파일로 정의해 사용한다.
- 그리고 쿠버네티스에서 실제로 서비스를 배포할 떄에도 `kubectl 명령어가 아닌 여러 개의 YAML 파일을 정의해` 쿠버네티스에 적용시키는 방식으로 동작할 것이다.

> 따라서 쿠버네티스를 잘 사용하는 방법을 한마디로 표현하자면 'YAML 파일을 잘 작성하는 것'이라고 해도 과언이 아니다.



## 여러 개의 컴포넌트로 구성
- 쿠버네티스 노드의 역할은 크게 마스터와 워커로 나뉘어 있다.
- 마스터 노드는 쿠버네티스가 제대로 동작할 수 있게 클러스터를 관리하는 역할을 하며, 워커 노드에는 애플리케이션 컨테이너가 생성된다.
- 쿠버네티스에는 도커를 포함한 매우 많은 컴포넌트들이 실행된다.
- 예를 들어, 마스터 노드에서는 `API 서버(kube-apiserver)`, `컨트롤러 매니저(kube-controller-manager)`, `스케줄러(kube-scheduler)`, `DNS서버(coreDNS)` 등이 실행되며, 모든 노드에서는 오버레이 네트워크 구성을 위해 `프록시(kube-proxy)`와 `네트워크 플러그인(calico, flannel 등)`이 실행된다.
- 이러한 컴포넌트들은 기본적으로 컨테이너로서 실행되고 있으며, 마스터 노드에 SSH로 접속해 crictl 명령어를 실행해보면 매우 많은 컨테이너가 실행되고 있을 것이다.
    ```
    crictl --runtime-endpoint unix:///run/containerd/containerd.sock ps
    ```

> Docker Desktop for Windows/Mac에서는 Preferences에서 [Kubernetes] 탭을 선택한 다음 `Show system containers` 항목에 체크하면 `docker ps`의 출력에서 쿠버네티스의 컴포넌트 컨테이너를 확인할 수 있다.

<br>

- 그리고 쿠버네티스 클러스터 구성을 위해 `kubelet`라는 에이전트가 모든 노드에서 실행된다. 
- `kubelet`은 컨테이너의 생성, 삭제뿐만 아니라 마스터와 워커 노드 간의 통신 역할을 함께 담당하는 `매우 중요한 에이전트`이다.
> 따라서 kubelet이 정상적으로 실행되지 않으면 해당 노드는 쿠버네티스와 제대로 연결되지 않을 수 있다.

<br>

- 쿠버네티스의 입장에서 보면 컨테이너 런타임 인터페이스를 제공하는 `containerd`나 `cri-o`, 또는 `docker-cri` 또한 하나의 컴포넌트이다.
- 쿠버네티스는 도커에 내장된 기능이 아니며, 오히려 컨테이너를 사용하기 위해 쿠버네티스가 다른 컴포넌트를 이용하는 방식이다.
- 따라서 쿠버네티스에서 반드시 containerd를 사용해야할 필요는 없고, OCI(Open Container Initiative)라는 컨테이너 런타임 표준을 구현한 컨테이너 런타임을 갖추고 있다면 어느 것을 써도 문제는 없다.

> Container Runtime Interface는 kubelet이 컨테이너를 제어하기 위한 인터페이스를 의미한다.

<br>

- 이렇게 많고 복잡한 컴포넌트를 한번에 외우거나 이해하기 보다는, 필요할 때마다 쿠버네티스의 기능과 컴포넌트를 엮어 이해해도 아무런 문제가 없다.
- 지금은 `kubelet`라는 에이전트가 모든 노드에서 기본적으로 실행되며, `마스터 노드에는 API 서버 등이 컨테이너로 실행된다` 정도만 알면 된다.


